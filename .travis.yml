sudo: required
os:
  - linux
  - osx
dist: trusty
addons:
  apt:
    sources:
    - sourceline: 'ppa:bitcoin/bitcoin'
      key_url: 'http://keyserver.ubuntu.com:11371/pks/lookup?op=get&search=0xD46F45428842CE5E'
    packages:
      - bitcoind
language:
  - cpp
cache:
  - ccache
  - directories:
    - $HOME/.cache
before_install:
  - do_on(){ if [ "$TRAVIS_OS_NAME" = "$1" ]; then shift; $@ ; fi; }
  - do_on osx pip install --upgrade pip
  - do_on osx pip install virtualenv
install:
  - ./install.sh --develop --no-gpg-validation
before_script:
  - source jmvenv/bin/activate
script:
  - do_on linux bitcoind --help | head -1
  - do_on linux ./test/run_tests.sh
after_success:
  - do_on linux coveralls
after_failure:
  - echo "at least cache some stuff"
branches:
 only:
  - master
  - travis-test-linux-and-osx-no-brew
